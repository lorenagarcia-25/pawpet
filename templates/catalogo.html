{% extends 'base.html' %}
{% block title %} index {% endblock %}
{% block content %}
<div class="container overflow-hidden">
    <div class="row gy-4 gy-xxl-5">
        {% for p in productos %}
        <div class="col-12 col-md-6 col-lg-4 d-flex">
            <article class="d-flex">
                <div class="card border border-dark"
                    style="--bs-card-border-radius: 0; --bs-card-inner-border-radius: 0;">
                    <figure class="card-img-top m-0 overflow-hidden bsb-overlay-hover">
                        <a href="#!" data-bs-toggle="modal" data-bs-target="#modal{{p.idProducto}}">
                            <img class="img-fluid bsb-scale bsb-hover-scale-up" loading="lazy"
                                src="{{url_for('static', filename = 'uploads/' + p.imagen)}}"
                                alt="{{p.nombre_producto}}">
                        </a>
                        <figcaption>
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                                class="bi bi-eye text-white bsb-hover-fadeInLeft" viewBox="0 0 16 16">
                                <path
                                    d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                <path
                                    d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                            </svg>
                            <h4 class="h6 text-white bsb-hover-fadeInRight mt-2">ver producto</h4>
                        </figcaption>
                    </figure>
                    <div class="card-body border-0 bg-white p-4">
                        <h5 class="card-title">{{p.nombre_producto}}</h5>
                        <p class="card-text text-secondary">{{p.descripcion}}</p>
                        <p class="card-text"><strong>${{ "{:,.0f}".format(p.precio)}}</strong></p>
                        <form action="{{url_for('agregarCarrito', id=p.idProducto)}}" method="POST">
                            <input type="number" name="cantidad" value="1" min="1" max="{{p.cantidad}}"
                                class="form-control mb-2" {% if p.cantidad==0 %}disabled{% endif %}>

                            {% if p.cantidad ==0 %}
                            <p class="text-danger ">Producto agotado</p>
                            {% else%}
                            <p class="text-success ">Disponible: {{p.cantidad}}</p>
                            {% endif %}

                            <button type="submit"
                                class="{% if p.cantidad == 0 %}btn-secondary disabled{% else %}btn-success{% endif %} w-100"
                                {% if p.cantidad==0 %}disabled{% endif %}> Agregar al carrito</button>
                        </form>
                    </div>
                </div>
            </article>
        </div>
        {% endfor %}
    </div>
</div>
{% for p in productos %}
<!-- The Modal -->
<div class="modal fade" id="modal{{p.idProducto}}" tabindex="-1" aria-labelledby="modalTitle{{p.idProducto}}"
    aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content" role="dialog" aria-describedby="modalDesc{{p.idProducto}}">

            <!-- Modal Header -->
            <div class="modal-header bg-white border-bottom-0">
                <h4 class="modal-title w-100 text-center fw-bold text-dark" id="modalTitle{{p.idProducto}}">
                    {{p.nombre_producto}}</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body text-center overflow-auto" style="max-height:70vh;">
                <img src="{{url_for('static', filename = 'uploads/' + p.imagen)}}" alt="{{p.nombre_producto}}"
                    class="img-fluid roundered mb-3" style="max-height: 300px;">
                <p id="modalDesc{{p.idProducto}}" class="text-muted">{{p.descripcion}}</p>
                <p class="fs-5 fw-bold text-success">${{ "{:,.0f}".format(p.precio)}}</p>

                <form action="{{url_for('agregarCarrito', id=p.idProducto)}}" method="POST" class="mt-3">
                    <input type="hidden" name="idProducto" value="{{p.idProducto}}">
                    <div class="row g2 justify-content-center">
                        <div class="col-6 col-md-4">
                            <input type="number" name="cantidad" value="1" min="1" max="{{p.cantidad}}"
                                class="form-control mb-2" {% if p.cantidad==0 %}disabled{% endif %}>
                        </div>
                        {% if p.cantidad ==0 %}
                        <p class="text-danger ">Producto agotado</p>
                        {% else%}
                        <p class="text-success ">Disponible: {{p.cantidad}}</p>
                        {% endif %}
                        <div class="col-12 col-md-6">
                            <button type="submit"
                                class="{% if p.cantidad == 0 %}btn-secondary disabled{% else %}btn-success{% endif %} w-100"
                                {% if p.cantidad==0 %}disabled{% endif %}> Agregar al carrito</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer justify-content-center border-top-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>

        </div>
    </div>
</div>
{% endfor %}
{% endblock %}
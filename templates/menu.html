<!DOCTYPE html>

<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Menú Desplegable Estilizado</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='principal.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    /* Contenedor del menú */
    .menu-container {
      display: flex;
      flex-direction: column;

    }

    .hamburger {
      padding: 10px;
    }

    /* Menú desplegable */
    .dropdown-menu {
      display: none;
      flex-direction: column;
      background-color: #8ab4f2;
      margin-top: -20px;
      margin-left: 5px;
      
      box-sizing: border-box;
    }


    .dropdown.show .dropdown-menu {
      display: flex;
    }

    /* Ítems del menú */
    .dropdown-item {
      color: #181717;
      text-align: center;
      width: 100%;
      font-family: "DM Serif Text", serif;
      font-weight: 400px;
      font-style: normal;
      font-size: 20px;
    }

    @media (max-width: 700px) {
      .dropdown-menu {
        margin-left: 5px;
        margin-top: -18px;
        height: 230px;
      }

      .hamburger {
        padding: 5px;
      }

      .dropdown-item {
        text-align: center;
        font-size: 15px;

      }
    
       
    }
  </style>
</head>

<body>

  <div class="barra_rosada">
    <!-- IZQUIERDA: menú y logo -->
    <div class="barra_izquierda">

      <div class="hamburger" onclick="toggleMenu()">
        <img src="{{ url_for('static', filename='img/menu.png') }}" alt="icono" id="mune">
      </div>

      <a href="{{url_for('index')}} ">
        <img src="{{ url_for('static', filename='img/huellitas_felices.png') }}" alt="logo" id="logo">
      </a>
    </div>

    <!-- DERECHA: buscador y usuario -->
    <div class="barra_derecha">


<!-- Buscador -->
 <div class="container "></div>
<div class="input-group  " style="margin-right:10px ;width: 600px;">
  <span class="input-group-text bg-dark text-white border-dark" id="label-buscador">
    <i class="bi bi-search"></i>
  </span>
  <input type="text" id="buscador" class="form-control border-dark"
         placeholder="Buscar Productos"
         aria-label="Buscar productos" aria-describedby="label-buscador">
</div>

        
      {% if session.get('rol') == 'admin' %}
      <li class="nav-item">
        <a class="nav-link text-white" href="{{url_for('dashboard')}}">dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="{{url_for('inventario')}}">Inventario</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" href="{{url_for('catalogo')}}">catalogo</a>
      </li>
      {% endif %}

      {% if session.get('usuario') %}
      <div class="nav-item me-3">
        <a class="nav-link text-white d-flex align-items-center" href="{{url_for('carrito')}}"><i
            class="bi bi-cart3 fs-1"></i>{{carrito_cantidad}}</a>
      </div>

      <div class="nav-item fs-5" style="margin-right:30px">
        <a class="nav-link text-dark" href="{{ url_for('logout') }}">Cerrar Sesión</a>
      </div>
      {% else %}
      <a class="nav-link text-white" href="{{url_for('login')}} ">
        <img src="{{ url_for('static', filename='img/usuario_logo.png') }}" alt="usuario" class="lusuario">
      </a>
      {% endif %}

    </div>
  </div>

  <div class="menu-container">

    <div class="dropdown" id="menuDropdown">
      <button class="btn dropdown-togglee" type="button"></button>
      <ul class="dropdown-menu" id="listaMenu">
        <li><a class="dropdown-item" href="{{url_for('dashboard')}}">dashboard</a></li>
        <li><a class="dropdown-item" href="{{url_for('inventario')}}">Inventario</a></li>
        <li><a class="dropdown-item" href="{{url_for('catalogo')}}">catalogo</a></li>
        <li><a class="dropdown-item" href="{{url_for('categorias')}}">categorias</a></li>
      </ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <script>
    function toggleMenu() {
      document.getElementById('menuDropdown').classList.toggle('show');
    }
  </script>



<!-- Contenedor donde se mostrarán los productos -->
<div id="contenedor-productos" class= "row gy-4 gx-4" class="row"></div>


<!-- Script para búsqueda de productos -->
<script>
document.getElementById("buscador").addEventListener("keyup", function() {
  let q = this.value;
  if (q === "") {
    document.getElementById("contenedor-productos").innerHTML = "";
    return;
  }

  fetch(`/buscar?q=${encodeURIComponent(q)}`)
    .then(res => res.json())
    .then(data => {
      let html = "";

      if (data.length > 0) {
        data.forEach(p => {
          html += `
            <div class="col-12 col-sm-6 col-md-4 col-lg-2 p-1">
              <div class="card h-100 w-100 shadow rounded-2"
                   style="background-color:#b2dafa; border: 2px solid #000; margin-top: 5px;">
                
                <figure class="card-img-top m-0 overflow-hidden bsb-overlay-hover">
                  <a href="#!" data-bs-toggle="modal" data-bs-target="#modal${p.idProducto}">
                    <img class="img-fluid rounded-top"
                         style="max-height: 160px; object-fit: cover;"
                         loading="lazy"
                         src="/static/uploads/${p.imagen}"
                         alt="${p.nombre_producto}">
                  </a>
                  <figcaption>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                         class="bi bi-eye text-white bsb-hover-fadeInLeft" viewBox="0 0 16 16">
                      <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                      <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                    </svg>
                    <h4 class="h6 text-white bsb-hover-fadeInRight mt-2">Ver producto</h4>
                  </figcaption>
                </figure>

                <div class="card-body border-0 bg-white p-4">
                  <h5 class="card-title">${p.nombre_producto}</h5>
                  <p class="card-text text-secondary">${p.descripcion}</p>
                  <p class="card-text"><strong>$${new Intl.NumberFormat().format(p.precio)}</strong></p>

                  <form action="/agregarCarrito/${p.idProducto}" method="POST">
                    <input type="number" name="cantidad" value="1" min="1" max="${p.cantidad}"
                           class="form-control mb-2" ${p.cantidad == 0 ? "disabled" : ""}>

                    ${p.cantidad == 0
                      ? `<p class="text-danger">Producto agotado</p>`
                      : `<p class="text-success">Disponible: ${p.cantidad}</p>`}

                    <button type="submit"
                            class="${p.cantidad == 0 ? "btn-secondary disabled" : "btn-success"} w-100"
                            ${p.cantidad == 0 ? "disabled" : ""}>
                      Agregar al carrito
                    </button>
                  </form>
                </div>
              </div>
            </div>
          `;
        });
      } else {
        html = "<p class='text-center text-muted'>No se encontraron resultados.</p>";
      }

      document.getElementById("contenedor-productos").innerHTML = html;
    })
    .catch(err => console.error("Error en la búsqueda:", err));
});
</script>


<script>
  function mostrarCategoria(idCategoria){
      fetch(`/productos_por_categoria/${idCategoria}`)
        .then(res => res.json())
        .then(data => {
          let html = "";
  
          if (data.length > 0) {
            data.forEach(p => {
              html += `
                <div class="col-12 col-md-6 col-lg-4 d-flex">
                  <article class="d-flex">
                    <div class="card border border-dark" style="--bs-card-border-radius:0; --bs-card-inner-border-radius:0;">
                      
                      <figure class="card-img-top m-0 overflow-hidden bsb-overlay-hover">
                        <a href="#!" data-bs-toggle="modal" data-bs-target="#modal${p.idProducto}">
                          <img class="img-fluid bsb-scale bsb-hover-scale-up" loading="lazy"
                               src="/static/uploads/${p.imagen}" alt="${p.nombre_producto}">
                        </a>
                        <figcaption>
                          <h4 class="h6 text-white mt-2">Ver producto</h4>
                        </figcaption>
                      </figure>
  
                      <div class="card-body border-0 bg-white p-4">
                        <h5 class="card-title">${p.nombre_producto}</h5>
                        <p class="card-text text-secondary">${p.descripcion}</p>
                        <p class="card-text"><strong>$${new Intl.NumberFormat().format(p.precio)}</strong></p>
  
                        <form action="/agregarCarrito/${p.idProducto}" method="POST">
                          <input type="number" name="cantidad" value="1" min="1" max="${p.cantidad}" 
                                 class="form-control mb-2" ${p.cantidad==0 ? "disabled" : ""}>
                          
                          ${p.cantidad == 0 
                            ? `<p class="text-danger">Producto agotado</p>` 
                            : `<p class="text-muted">Disponibles: ${p.cantidad}</p>`}
  
                          <button type="submit" 
                            class="${p.cantidad==0 ? "btn-secondary" : "btn-success"} w-100"
                            ${p.cantidad==0 ? "disabled" : ""}>Agregar al carrito</button>
                        </form>
                      </div>
                    </div>
                  </article>
                </div>
              `;
            });
          } else {
            html = "<p>No se encontraron resultados.</p>";
          }
  
          document.getElementById("contenedor-productos").innerHTML = html;
        })
        .catch(err => console.error("Error al cargar la categoria:", err));
  };
  </script>

  <!-- Script para búsqueda de productos -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
  
      fetch(`/categorias_disponibles`)
        .then(res => res.json())
        .then(categorias => {
          if(categorias.length===0)
          return;
        const titulo=document.createElement("li");
        titulo.innerHTML=`<h6 class="dropdown-header"> categorias disponibles</h6>`;
        listaMenu.appendChild(titulo);
        categorias.forEach(cat=>{
          const li=document.createElement("li");
          li.innerHTML=`<a class="dropdown-item" onclick="mostrarCategoriaPorNombre('${cat.nombre}')"> ${cat.nombre} </a>`;
          listaMenu.appendChild(li);
        });
        }).catch(err=>console.error("error al cargar las categorias",err));
        });
        function mostrarCategoriaPorNombre (nombreCategoria){
          fetch(`/productos_por_nombre_categoria/${encodeURIComponent(nombreCategoria)}`)
          .then(res => res.json())
        .then(data => { 
        const contenedor=document.getElementById("contenedor-productos");
          let html = "";
  
          if (data.length === 0) {
            html= `<p class="text-center mt-3"> No hay productos en esta categoria </p> `;
            } else{
            data.forEach(p => {
              html += `
                <div class="col-12 col-md-6 col-lg-4 d-flex">
                  <article class="d-flex">
                    <div class="card border border-dark" style="--bs-card-border-radius:0; --bs-card-inner-border-radius:0;">
                      
                      <figure class="card-img-top m-0 overflow-hidden bsb-overlay-hover">
                        <a href="#!" data-bs-toggle="modal" data-bs-target="#modal${p.idProducto}">
                          <img class="img-fluid bsb-scale bsb-hover-scale-up" loading="lazy"
                               src="/static/uploads/${p.imagen}" alt="${p.nombre_producto}">
                        </a>
                        <figcaption>
                          <h4 class="h6 text-white mt-2">Ver producto</h4>
                        </figcaption>
                      </figure>
  
                      <div class="card-body border-0 bg-white p-4">
                        <h5 class="card-title">${p.nombre_producto}</h5>
                        <p class="card-text text-secondary">${p.descripcion}</p>
                        <p class="card-text"><strong>$${new Intl.NumberFormat().format(p.precio)}</strong></p>
  
                        <form action="/agregarCarrito/${p.idProducto}" method="POST">
                          <input type="number" name="cantidad" value="1" min="1" max="${p.cantidad}" 
                                 class="form-control mb-2" ${p.cantidad==0 ? "disabled" : ""}>
                          
                          ${p.cantidad == 0 
                            ? `<p class="text-danger">Producto agotado</p>` 
                            : `<p class="text-muted">Disponibles: ${p.cantidad}</p>`}
  
                          <button type="submit" 
                            class="${p.cantidad==0 ? "btn-secondary" : "btn-success"} w-100"
                            ${p.cantidad==0 ? "disabled" : ""}>Agregar al carrito</button>
                        </form>
                      </div>
                    </div>
                  </article>
                </div>
              `;
            });
          }
  
         contenedor.innerHTML = html;
        })
        .catch(err => console.error("Error al mostrar productos:", err));
  };
  </script>





</body>

</html>
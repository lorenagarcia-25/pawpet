{% extends 'base.html' %}

{% block title %}Inventario{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='inventario.css') }}">

<div class="container mb-4">
  <h3>Gestión de Inventario</h3>

  <!-- 🔹 Botón para abrir modal de agregar -->
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAgregar">Agregar productos</button>
  <br><br>

  <!-- 🔹 Tabla de productos -->
  <table class="table table-bordered table-hover">
    <thead class="table-light">
      <tr>
        <th>Imagen</th>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Categoría</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for p in productos  %}
      <tr>
        <td><img src="{{ url_for('static', filename='uploads/' + p.imagen) }}" width="80"></td>
        <td>{{ p.nombre_producto }}</td>
        <td>${{ p.precio }}</td>
        <td>{{ p.cantidad }}</td>
         {% for c in categorias %}
          {% if p.idCategoria == c.idCategoria %}
        <td>{{ c.nombre }}</td>
            {% endif %}
        {% endfor %}
        <td>
          <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modalEditar{{p['idProducto']}}">Editar</button>
          <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalEliminar{{p['idProducto']}}">Eliminar</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- 🔹 Modal AGREGAR PRODUCTO (fuera del bucle) -->
<div class="modal fade" id="modalAgregar" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form action="{{ url_for('agregar_producto') }}" method="POST" enctype="multipart/form-data">
      <div class="modal-content">

        <!-- Encabezado -->
        <div class="modal-header">
          <h4 class="modal-title">Agregar Producto</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Cuerpo -->
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="nombre" class="form-label">Nombre</label>
              <input type="text" class="form-control" name="nombre" id="nombre" required>
            </div>
            <div class="col-md-6">
              <label for="precio" class="form-label">Precio</label>
              <input type="number" class="form-control" name="precio" id="precio" required>
            </div>
            <div class="col-md-12">
              <label for="descripcion" class="form-label">Descripción</label>
              <input type="text" class="form-control" name="descripcion" id="descripcion" required>
            </div>
            <div class="col-md-6">
              <label for="cantidad" class="form-label">Cantidad</label>
              <input type="number" class="form-control" name="cantidad" id="cantidad" required>
            </div>
            <div class="col-md-6">
              <label for="imagen" class="form-label">Imagen</label>
              <input type="file" class="form-control" name="imagen" id="imagen" required>
            </div>
            <div class="form-group">
              <label for="categoria" class="form-label">Categoría</label>
              <select name="categoria" class="form-select" required>
                <option value="">Selecciona la categoría</option>
                {% for c in categorias %}
                <option value="{{ c.idCategoria }}">{{ c.nombre }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <!-- Pie -->
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Guardar</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
        </div>

      </div>
    </form>
  </div>
</div>

<!-- 🔹 Modales EDITAR y ELIMINAR (dentro del bucle) -->
{% for p in productos %}

<!-- Modal EDITAR -->
<div class="modal fade" id="modalEditar{{p['idProducto']}}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form action="{{ url_for('editar_producto', id=p['idProducto']) }}" method="POST" enctype="multipart/form-data">
      <div class="modal-content">

        <div class="modal-header">
          <h4 class="modal-title">Editar Producto</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="nombre{{ p['idProducto'] }}">Nombre</label>
            <input type="text" class="form-control" name="nombre" id="nombre{{ p['idProducto'] }}" value="{{ p['nombre_producto'] }}" required>
          </div>

          <div class="form-group">
            <label for="descripcion{{ p['idProducto'] }}">Descripción</label>
            <input type="text" class="form-control" name="descripcion" id="descripcion{{ p['idProducto'] }}" value="{{ p['descripcion'] }}" required>
          </div>

          <div class="form-group">
            <label for="precio{{ p['idProducto'] }}">Precio</label>
            <input type="number" class="form-control" name="precio" id="precio{{ p['idProducto'] }}" value="{{ p['precio'] }}" required>
          </div>

          <div class="form-group">
            <label for="cantidad{{ p['idProducto'] }}">Cantidad</label>
            <input type="number" class="form-control" name="cantidad" id="cantidad{{ p['idProducto'] }}" value="{{ p['cantidad'] }}" required>
          </div>

          <div class="form-group">
            <label for="imagen{{ p['idProducto'] }}">Imagen</label>
            <input type="file" class="form-control" name="imagen" id="imagen{{ p['idProducto'] }}">
          </div>

          <div class="form-group">
            <label for="categoria" class="form-label">Categoría</label>
            <select name="categoria" class="form-select">
              <option value="">Selecciona la categoría</option>
              {% for c in categorias %}
              <option value="{{ c.idCategoria }}" {% if p.idCategoria == c.idCategoria %}selected{% endif %}>{{ c.nombre }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Guardar cambios</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>

      </div>
    </form>
  </div>
</div>

<!-- Modal ELIMINAR -->
<div class="modal fade" id="modalEliminar{{p['idProducto']}}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title">Eliminar Producto</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>¿Estás seguro de que deseas eliminar el producto "<strong>{{ p.nombre_producto }}</strong>"?</p>
      </div>

      <div class="modal-footer">
        <a href="{{ url_for('eliminar_producto', id=p['idProducto']) }}" class="btn btn-danger">Eliminar</a>
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cancelar</button>
      </div>

    </div>
  </div>
</div>

{% endfor %}

{% endblock %}
